<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="https://upload.wikimedia.org/wikipedia/commons/thumb/4/44/Microsoft_logo.svg/2000px-Microsoft_logo.svg.png">

  <title>
    
      Ruby Ubuntu
    
  </title>
  <meta name="description" content="Get started with SQL Server on macOS, Linux, and Windows.">
  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/ruby/ubuntu/step/3">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-62780441-15', 'auto');
  ga('send', 'pageview');
  $(document).ready(function() {
      $("code").bind({
          copy: function(event) {
              ga("send", "event", {
                  eventCategory: window.location.pathname,
                  eventAction: "copy_code"
              });
         console.log("Copy");

          }, 

          cut: function(event) {
              ga("send", "event", {
                  eventCategory: window.location.pathname,
                  eventAction: "copy_code"
              });
          }
      })

      $("a").click(function(event) {
          ga("send", "event", {
              eventCategory: window.location.pathname,
              eventAction: "click_link",
              eventLabel: event.target.href
          });
      })
  });  
  </script>



</head>


  <body>

    <header class="sql-header sql-header--empty" role="banner">
    <div class="sql-header-content">
      <img class="sql-header-micro" src="/assets/images/micro-logo.png" alt="Microsoft logo">
      
        <div class="sql-menutop">
          <a class="sql-menutop-link" href="/">Get started with SQL Server</a>
          <div>
            
              
              

              <div class="sql-menutop-sub ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">C# </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/csharp/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/csharp/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/csharp/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/csharp/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
              
              

              <div class="sql-menutop-sub ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">Java </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/java/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/java/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/java/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/java/sles" 
                                target="_self">
                                SLES
                                
                                  <i class="sql-new"></i>
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/java/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
              
              

              <div class="sql-menutop-sub ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">Node.js </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/node/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/node/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/node/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/node/sles" 
                                target="_self">
                                SLES
                                
                                  <i class="sql-new"></i>
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/node/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
              
              

              <div class="sql-menutop-sub ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">PHP </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/php/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/php/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/php/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/php/sles" 
                                target="_self">
                                SLES
                                
                                  <i class="sql-new"></i>
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/php/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
              
              

              <div class="sql-menutop-sub ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">Python </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/python/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/python/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/python/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/python/sles" 
                                target="_self">
                                SLES
                                
                                  <i class="sql-new"></i>
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/python/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
              
              

              <div class="sql-menutop-sub  is-active ">
                  
                    
                      
                      

                        
                          <span class="sql-menutop-link">Ruby </span>
                        

                        
                    
                      
                      

                        

                        
                          <div class="sql-menutop-items">
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/ruby/mac" 
                                target="_self">
                                macOS
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/ruby/rhel" 
                                target="_self">
                                RHEL
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item  is-active " 
                                href="/ruby/ubuntu" 
                                target="_self">
                                Ubuntu
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/ruby/sles" 
                                target="_self">
                                SLES
                                
                                  <i class="sql-new"></i>
                                
                              </a>
                            
                              
                              
                              

                              <a class="sql-menutop-item " 
                                href="/ruby/windows" 
                                target="_self">
                                Windows
                                
                              </a>
                            
                          </div>
                        
                    
                  
              </div>
            
          </div>
        </div>

      
</header>


    <main class="sql-main" aria-label="Content">
      <div class="u-wrapper">
        <article class="sql-page_steps">

  
    
    
    

    <h1 class="sql-page_steps-hero">
      Create Ruby apps using SQL Server on Ubuntu
    </h1>

    <header class="sql-page_steps-steps js-stepsheader">
      
        
        

        <div class="sql-page_steps-step">
          
            <a class="sql-page_steps-link "
               href="/ruby/ubuntu"
               target="_self">
               <span class="sql-page_steps-number">1</span>
               Set up your environment
              </a>
          
        </div>
      
        
        

        <div class="sql-page_steps-step">
          
            <a class="sql-page_steps-link "
               href="/ruby/ubuntu/step/2"
               target="_self">
               <span class="sql-page_steps-number">2</span>
               Create Ruby application with SQL server
            </a>
          
        </div>
      
        
        

        <div class="sql-page_steps-step">
          
            <a class="sql-page_steps-link  sql-page_steps-link--active "
               href="/ruby/ubuntu/step/3"
               target="_self">
               <span class="sql-page_steps-number">3</span>
               Make your Ruby app up to 100x faster
            </a>
          
        </div>
      
    </header>
  

  <div class="sql-page_steps-loading js-loading">
    <p></p>
    <p></p>
    <p></p>
    <p></p>
    <div></div>
    <div></div>
    <p></p>
    <div></div>
    <div></div>
    <p></p>
    <div></div>
    <div></div>
    <div></div>
    <div></div>
    <p></p>
    <p></p>
    <div></div>
    <div></div>
    <div></div>
    <p></p>
    <div></div>
    <div></div>
    <p></p>
    <p></p>
    <div></div>
    <div></div>
    
  </div>

  <div class="js-steps is-hidden">
    
<blockquote>
  <p>In this section we will show you a simple example of Columnstore Indexes and how they can improve data processing speeds. Columnstore Indexes can achieve up to 100x better performance on analytical workloads and up to 10x better data compression than traditional rowstore indexes.</p>
</blockquote>

<h2 id="step-31-create-a-ruby-app-to-demonstrate-columnstore-indexes">Step 3.1 Create a Ruby app to demonstrate Columnstore indexes</h2>

<p>Create a new directory for your project and install TinyTDS.</p>

<div class="language-terminal highlighter-rouge"><pre class="highlight"><code>mkdir SqlServerColumnstoreSample
cd SqlServerSample
gem install tiny_tds
</code></pre>
</div>
<p>Using your favorite text editor, create a file called <strong>columnstore.rb</strong> in the SqlServerColumnstoreSample folder. Copy and paste the below code inside it. Save and close the file.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'tiny_tds'</span>
<span class="vi">@client</span> <span class="o">=</span> <span class="no">TinyTds</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span> <span class="ss">username: </span><span class="s1">'sa'</span><span class="p">,</span> <span class="ss">password: </span><span class="s1">'your_password'</span><span class="p">,</span>
    <span class="ss">host: </span><span class="s1">'localhost'</span><span class="p">,</span> <span class="ss">port: </span><span class="mi">1433</span><span class="p">,</span> <span class="ss">timeout: </span><span class="mi">60</span>

<span class="c1"># Calculate time difference in milliseconds</span>
<span class="k">def</span> <span class="nf">time_diff_milli</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">finish</span><span class="p">)</span>
   <span class="p">((</span><span class="n">finish</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">).</span><span class="nf">floor</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
    <span class="vi">@client</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">).</span><span class="nf">do</span>
    <span class="kp">true</span>
<span class="k">end</span>

<span class="c1"># Create database</span>
<span class="nb">puts</span> <span class="s2">"Dropping and creating database 'SampleDB'"</span>
<span class="n">execute</span><span class="p">(</span><span class="s2">"DROP DATABASE IF EXISTS [SampleDB]; CREATE DATABASE [SampleDB];"</span><span class="p">)</span>

<span class="c1"># Insert 5 million rows into the table 'Table_with_5M_rows'</span>
<span class="nb">puts</span> <span class="s2">"Inserting 5 million rows into table 'Table_with_5M_rows'. This takes ~1 minute, please wait."</span>
<span class="n">execute</span><span class="p">(</span><span class="s2">"USE SampleDB; WITH a AS (SELECT * FROM (VALUES(1),(2),(3),(4),(5),(6),(7),(8),(9),(10)) AS a(a))
    SELECT TOP(5000000)
    ROW_NUMBER() OVER (ORDER BY a.a) AS OrderItemId
    ,a.a + b.a + c.a + d.a + e.a + f.a + g.a + h.a AS OrderId
    ,a.a * 10 AS Price
    ,CONCAT(a.a, N' ', b.a, N' ', c.a, N' ', d.a, N' ', e.a, N' ', f.a, N' ', g.a, N' ', h.a) AS ProductName
    INTO Table_with_5M_rows
    FROM a, a AS b, a AS c, a AS d, a AS e, a AS f, a AS g, a AS h;"</span><span class="p">)</span>

<span class="c1"># Execute query without columnstore index</span>
<span class="n">t1</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT SUM(Price) as sum FROM Table_with_5M_rows"</span><span class="p">)</span>
<span class="n">t2</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">elapsedTimeWithoutIndex</span> <span class="o">=</span> <span class="n">time_diff_milli</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span>
<span class="nb">puts</span> <span class="s2">"Query time without columnstore index: </span><span class="si">#{</span><span class="n">elapsedTimeWithoutIndex</span><span class="si">}</span><span class="s2">ms"</span>

<span class="c1"># Create columnnstore index on table 'Table_with_5M_rows'</span>
<span class="nb">puts</span><span class="p">(</span><span class="s2">"Adding a columnstore index to table 'Table_with_5M_rows'"</span><span class="p">)</span>
<span class="n">execute</span><span class="p">(</span><span class="s2">"CREATE CLUSTERED COLUMNSTORE INDEX columnstoreindex ON Table_with_5M_rows;"</span><span class="p">)</span>

<span class="c1"># Execute the same query with columnstore index</span>
<span class="n">t3</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">execute</span><span class="p">(</span><span class="s2">"SELECT SUM(Price) as sum FROM Table_with_5M_rows"</span><span class="p">)</span>
<span class="n">t4</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">elapsedTimeWithIndex</span> <span class="o">=</span> <span class="n">time_diff_milli</span> <span class="n">t3</span><span class="p">,</span> <span class="n">t4</span>
<span class="nb">puts</span> <span class="s2">"Query time WITH columnstore index: </span><span class="si">#{</span><span class="n">elapsedTimeWithIndex</span><span class="si">}</span><span class="s2">ms"</span>

<span class="c1"># Calculate performance improvement with columnstore index</span>
<span class="n">perf_improvement</span> <span class="o">=</span> <span class="p">(</span><span class="n">elapsedTimeWithoutIndex</span> <span class="o">/</span> <span class="n">elapsedTimeWithIndex</span><span class="p">).</span><span class="nf">floor</span>
<span class="nb">puts</span> <span class="s2">"Performance improvement with columnstore index: </span><span class="si">#{</span><span class="n">perf_improvement</span><span class="si">}</span><span class="s2">x!"</span>

<span class="vi">@client</span><span class="p">.</span><span class="nf">close</span>
</code></pre>
</div>

<pre><code class="language-results">Dropping and creating database 'SampleDB'
Inserting 5 million rows into table 'Table_with_5M_rows'. This takes ~1 minute, please wait.
Query time without columnstore index: 363ms
Adding a columnstore index to table 'Table_with_5M_rows'
Query time WITH columnstore index: 5ms
Performance improvement with columnstore index: 71x!
</code></pre>

<blockquote>
  <p>Congrats you just made your Ruby app faster using Columnstore Indexes!</p>
</blockquote>


  </div>

  
    
    

          
            <a class="sql-page_steps-next" href="https://github.com/rails-sqlserver/tiny_tds">Check out the Ruby Driver tinytds on GitHub</a>
          

      <div class="sql-resources">
    <header class="sql-resources-header">
        <h3 class="sql-resources-title">
            To get general documentations
        </h3>
        <a class="sql-resources-button"
            target="_blank"
            href="https://msdn.microsoft.com/en-us/library/mt590198(v=sql.1).aspx">
            Read the SQL Server documentation
        </a>
    </header>

    <div class="sql-resources-list">
        <h3 class="sql-resources-title">
            Check out other related tutorials and SQL Server features!
        </h3>
        
            <ul class="sql-resources-items">
                
                    
                    
                
                    
                    
                
                    
                    
                
                    
                    
                
                    
                    
                
                    
                    
                        <li class="sql-resources-item">
                            Browse more SQL Server code samples (In-Memory, Dynamic Data Masking, R, etc.) on our <a class="sql-resources-link" href="https://github.com/Microsoft/sql-server-samples/tree/master/samples/" target="_blank">GitHub repository</a>
                        </li>
                    
                
                    
                    
                        <li class="sql-resources-item">
                            Learn more about <a class="sql-resources-link" href="https://channel9.msdn.com/Events/Connect/2016/101" target="_blank">SQL Server on Linux</a>
                        </li>
                    
                
                    
                    
                        <li class="sql-resources-item">
                            Watch more <a class="sql-resources-link" href="https://channel9.msdn.com/Events/Connect/2016" target="_blank">Connect(); event videos</a>
                        </li>
                    
                
                    
                    
                        <li class="sql-resources-item">
                            Browse our <a class="sql-resources-link" href="https://technet.microsoft.com/en-us/virtuallabs" target="_blank">Virtual Labs Gallery</a>
                        </li>
                    
                
            </ul>
      
    </div>
</div>
    
  

  <div class="sql-questions">
    <h2 class="sql-questions-title">
        Have Questions?
    </h2>
    <p class="sql-questions-text">
        Happy to help! You can find us on <a href="https://github.com/Microsoft/sql-server-samples/tree/master/samples/tutorials" target="_blank">GitHub</a>, <a href="https://social.msdn.microsoft.com/Forums/en-US/home target="_blank"">MSDN Forums</a>, and StackOverflow. We also monitor the <a href="https://twitter.com/search?q=%23SQLServerDev&amp;src=typd" target="_blank">#SQLServerDev</a> hashtag on Twitter.
    </p>
</div>

  
      <footer class="sql-disqus">
        

      </footer>
  
</article>

      </div>
    </main>

    <footer class="sql-footer">
  




    <div class="sql-footer-copy">
        <a class="sql-footer-link" href="https://go.microsoft.com/?linkid=2028325">Contact us</a> | 
        <a class="sql-footer-link" href="https://go.microsoft.com/fwlink/?LinkId=521839">Privacy & cookies</a> | 
        <a class="sql-footer-link" href="https://go.microsoft.com/fwlink/?LinkID=206977">Terms of use</a> | 
        <a class="sql-footer-link" href="https://www.microsoft.com/trademarks">Trademarks</a> | 
        <a class="sql-footer-link" href="https://choice.microsoft.com/">About our ads</a> | 
        Â© 2017 Microsoft 
      <!--
        <a href="#" target="_blank" class="sql-footer-icon fa fa-twitter" aria-hidden="true" style="float:right;"></a>
        <a href="#" target="_blank" class="sql-footer-icon fa fa-github" aria-hidden="true" style="float:right;"></a>
      -->
    </div>

           
</footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js" type="text/javascript"></script>
<script src="https://use.fontawesome.com/c7b2a63f93.js"></script>
<script src="/assets/scripts/prism.js" type="text/javascript"></script>
<script src="/assets/scripts/steps.js" type="text/javascript"></script>
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'Microsoft/mssql-developers'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
  </body>

</html>
